#!/usr/bin/env bash

readonly BD_CACHE="$HOME/.cache/bd"

if [ ! -d "$BD_CACHE" ]; then
  mkdir $BD_CACHE
fi

if [ -v BD_EJECTED ]; then
  SCRIPT=$0
else
  SCRIPT=$1
  shift
fi

ARGS=($@)
SCRIPT_NAME=$SCRIPT

BD_ROOT="$(realpath $(dirname $0)/..)"
BD_BIN=$BD_ROOT/bin/bd

function bd_import() {
  source $@
}

bd_import $BD_ROOT/lib/print.sh
bd_import $BD_ROOT/lib/confirm.sh
bd_import $BD_ROOT/lib/iteration.sh
bd_import $BD_ROOT/lib/args.sh
bd_import $BD_ROOT/lib/metadata.sh

if [ "$SCRIPT" == "eject" ]; then
  SCRIPT=${ARGS[0]}
  SCRIPT_NAME=$SCRIPT
  shift
  ARGS=($@)
  source $BD_ROOT/lib/eject.sh
fi

bd_import $SCRIPT
