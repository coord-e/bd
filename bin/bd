#!/usr/bin/env bash

readonly BD_CACHE="$HOME/.cache/bd"

if [ ! -d "$BD_CACHE" ]; then
  mkdir $BD_CACHE
fi

if [ -v BD_EJECTED ]; then
  BD_SCRIPT=$0
else
  BD_SCRIPT=$1
  shift
fi

BD_ARGS=($@)
BD_SCRIPT_NAME=$BD_SCRIPT

BD_ROOT="$(realpath $(dirname $0)/..)"
BD_BIN=$BD_ROOT/bin/bd

function bd_import() {
  source $@
}

bd_import $BD_ROOT/lib/print.sh
bd_import $BD_ROOT/lib/confirm.sh
bd_import $BD_ROOT/lib/iteration.sh
bd_import $BD_ROOT/lib/args.sh
bd_import $BD_ROOT/lib/metadata.sh
bd_import $BD_ROOT/lib/run.sh

if [ "$BD_SCRIPT" == "eject" ]; then
  BD_SCRIPT=${BD_ARGS[0]}
  BD_SCRIPT_NAME=$BD_SCRIPT
  shift
  BD_ARGS=($@)
  source $BD_ROOT/lib/eject.sh
fi

bd::run $BD_SCRIPT
