#!/usr/bin/env bd

name "bd installer script"
description << EOF
Install bd, the bash framework to build CLI tools.
EOF

info "Welcome to bd!"

confirm "This script will install bd to '~/.bd'. Proceed?" || error_exit "Aborting installation"

info "Starting the installation..."

progress "Checking the current installation..."
if type bd > /dev/null 2>&1; then
  warn "It seems that bd is already installed."
  confirm "Overwrite?"
  info "Launchng uninstaller"
  eval "$(bd uninstall -)"
  info "Uninstalled the previous installation."
fi

progress "Checking the version of bash..."
[ "${BASH_VERSINFO}" -lt 4 ] && error_exit "bd requires bash >= 4, however you have version ${BASH_VERSINFO}. Aborting"

progress "Cloning bd to ~/.bd"
git clone https://github.com/coord-e/bd.git ~/.bd

progress "Appending the installation path to PATH..."
echo 'export PATH="~/.bd/bin:$PATH"' >> ~/.bash_profile

info "Done!"

info "Restart your shell so the path changes take effect."
info 'e.g. exec -l $SHELL'
